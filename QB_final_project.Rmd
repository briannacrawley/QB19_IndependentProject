---
title: "QB_final_project"
author: "Lana Bolin"
date: "2/6/2019"
output: html_document
---

---
title: "Bolin, Caple, and Crawley independent project (QB2019)"
author: "Lana Bolin"
date: "1/31/2019"
output:
  pdf_document: default
  html_document: default
---

# Setup

```{r, warning=F, message=F}
rm(list = ls())
getwd()
setwd("~/GitHub/QB19_IndependentProject/")
require("vegan")
require("dplyr")
require("magrittr")
require("ggplot2")

crawley.full <- read.csv("Crawley.csv")
```


Nativity codes are:   
0 = native to Indiana  
1 = native to the US  
2 = exotic  
3 = invasive  

Check how many of each nativity code we have using dplyr
```{r}
crawley.full %>%
  group_by(Nativity.Code) %>%
  summarize(grpcount = n())

# Those 8 empty ones are just empty rows at the bottom of the df. Let's get rid of those, as well as the two empty columns at the end
crawley.full <- crawley.full[-c(293:300), -c(24, 25)]

```


# Plots

## Richness vs. Invasive present / Invasive absent in community

Make site-by-species matrix where nativity code is "0" for Native, "1" for Invasive/Exotic
```{r}
# We want to separate into two df's: one for sites that have at least one invasive, and one for sites that don't.

# To do that, we make a vector of invasive species

crawley.inv <- crawley.full[crawley.full$ Nativity.Code == "3", ]

```

#### Every site has at least one invasive, so I can't make my plot!



## Mackenzie's initial idea: plot percent invasive species vs. species richness

```{r}
# subset data into separate data frames for each nativity code
nativeIN <- subset(crawley.full, Nativity.Code == "0")
nativeUS <- subset(crawley.full, Nativity.Code == "1")
exotic <- subset(crawley.full, Nativity.Code == "2")
invasive <- subset(crawley.full, Nativity.Code == "3")
unknown <- subset(crawley.full, Nativity.Code == "UNK")

# sum columns to find observed species richness for each site; repeat for each nativity code
nativeIN.sr <- colSums(nativeIN[ , 4:23])
nativeUS.sr <- colSums(nativeUS[ , 4:23])
exotic.sr <- colSums(exotic[ , 4:23])
invasive.sr <- colSums(invasive[ , 4:23])
unknown.sr <- colSums(unknown[ , 4:23])

# calculate total native richness
native.sr <- nativeIN.sr + nativeUS.sr

# calculate total observed species richness
total.sr <- colSums(crawley.full[ , 4:23])

# this was a sanity check to make sure everything has worked so far
# total.osr <- nativeIN.sr + nativeUS.sr + exotic.sr + invasive.sr + unknown.sr
# total.sr == total.osr

# plot richness of invasive species vs total species richness
plot(invasive.sr, total.sr, ylim = range(0:70), xlim = range(0:15), 
     xlab = "Number of Invasive Species Present", ylab = "Total Observed Species Richness")
# add fit lines
abline(lm(total.sr~invasive.sr), col="blue") # regression line (y~x) 

# plot richness of invasive species vs native species richness
plot(invasive.sr, native.sr, ylim = range(0:70), xlim = range(0:15), 
     xlab = "Number of Invasive Species Present", ylab = "Number of Native Species Present", main = "Observed Richness of Native and Invasive Plants")
# add fit lines
abline(lm(native.sr~invasive.sr), col="blue") # regression line (y~x) 


# plot richness of native species richness vs invasive species 
plot(native.sr, invasive.sr, ylim = range(0:20), xlim = range(0:80), 
     ylab = "Number of Invasive Species Present", xlab = "Number of Native Species Present", main = "Observed Richness of Native and Invasive Plants")
# add fit lines
abline(lm(invasive.sr~native.sr), col="blue") # regression line (y~x) 

summary(lm(native.sr~invasive.sr))

```

> Ok, so there's a pretty clear positive trend for both graphs, which is pretty neat-- so from this data, it looks like adding invasives simply adds species, and there isn't evidence that the invasives are decreasing native or total species richness (the opposite, in fact, which is logical for the first graph but really interesting for the second graph)


## Beta diversity of sites

```{r}
# loading transposed site by species matrix with nativity/planting codes removed
sbs <- read.csv("sitebyspecies.csv", header = TRUE)
sbs <- sbs[ , -1]

## this was me trying to transpose the matrix, set the first row as column names and then giving up because the data was no longer considered numeric?
## i'm really just keeping this in the hopes that one day i'll be able to figure it out, we don't need it, feel free to delete
#sbs <- crawley.full[-c(293:300) ,-c(2, 3, 24, 25)]
#sbs <- t(sbs)
#colnames(sbs) <- sbs[1, ]
#sbs <- sbs[-1, -c(293:300)]
 
# calculated Sorenson similarity
sbs.ds <- vegdist(sbs, method = "bray", binary = TRUE)
sbs.ds

# heat map of site similarity
require(viridis)
levelplot(as.matrix(sbs.ds), aspect = "iso", col.regions = magma,
                    xlab = "GreenSpace Site", ylab = "GreenSpace Site", scales = list(cex = 0.5),
                    main = "Sorenson Distance")


```

> Not expecting to find any patterns with site similarity honestly (and it doesn't look like there are any!), but it's cool to see that they're overall pretty dissimilar. Wonder if that changes looking only at planted species?



## Planted species vs. volunteer species

```{r}
# ignore this for now, I'm just playin' 
planted <- subset(crawley.full, Planted.or.Volunteer == "1")
volunteer <- subset(crawley.full, Planted.or.Volunteer == "2")
planted.SR <- colSums(planted[ , 4:23])
volunteer.SR <- colSums(volunteer[ , 4:23])

plot(planted.SR, volunteer.SR, ylim = c(0, 80), xlim = c(0, 30),
     xlab = "Planted Species Richness",
     ylab = "Volunteer Species Richness", las = 1)

```








Ideas for further analysis:
-incorporate plot size
-indicator species
-planted species vs spontaneous species
